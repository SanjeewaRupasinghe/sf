!function(f){f(function(){var s=0,m="#pay_with_amazon",o="#classic_pay_with_amazon",u=null,_=null;f("form.checkout").on("checkout_place_order_success",function(e,a){return void 0!==a.amazonCreateCheckoutParams&&0<f(o).length&&(u=JSON.parse(a.amazonCreateCheckoutParams),_=void 0!==a.amazonEstimatedOrderAmount&&a.amazonEstimatedOrderAmount?JSON.parse(a.amazonEstimatedOrderAmount):null,d(o,"classic",u)),!0}),f("form#order_review").on("submit",function(e){if(!f(".wc-apa-widget-change").length&&"amazon_payments_advanced"===f("input[name=payment_method]:checked").val()){e.preventDefault();var a=new FormData(document.getElementById("order_review")),n=new URLSearchParams(window.location.search);a.append("amazon-classic-action","1"),a.append("key",n.get("key")),f.ajax({type:"post",data:a,processData:!1,contentType:!1,success:function(a){p(f("form#order_review"));try{if(!("success"===a.result&&void 0!==a.amazonCreateCheckoutParams&&0<f(o).length))throw"Result failure";u=JSON.parse(a.amazonCreateCheckoutParams),_=void 0!==a.amazonEstimatedOrderAmount&&a.amazonEstimatedOrderAmount?JSON.parse(a.amazonEstimatedOrderAmount):null,d(o,"classic",u)}catch(e){if(!0===a.reload)return void window.location.reload();!0===a.refresh&&f(document.body).trigger("update_checkout"),a.messages?r(f("form#order_review"),a.messages):r(f("form#order_review"),'<div class="woocommerce-error">'+wc_checkout_params.i18n_checkout_error+"</div>")}},error:function(e,a,n){p(f("form#order_review")),console.error(n)}})}return!0}),f(document.body).on("wc_fragments_loaded wc_fragments_refreshed",function(e){i("#pay_with_amazon_cart","cart")}),0<f("#pay_with_amazon_cart").length&&i("#pay_with_amazon_cart","cart");var t=f("#pay_with_amazon_product");if(0<t.length){var c=i("#pay_with_amazon_product","product");null!==c&&c.onClick(function(){var e=f(".single_add_to_cart_button");if(e.hasClass("disabled"))e.trigger("click");else{var a=0<t.closest("div.summary").length&&t.closest("div.summary");a&&l(a);var n=e.val()||0,o={action:amazon_payments_advanced.change_cart_action,_change_carts_nonce:amazon_payments_advanced.change_cart_ajax_nonce};f.each(e.closest("form.cart").serializeArray(),function(e,a){"add-to-cart"===a.name?o.product_id=a.value:o[a.name]=a.value}),o.quantity=o.quantity||1,o.variation_id=o.variation_id||0,o.product_id=o.product_id||n,f.ajax({url:amazon_payments_advanced.ajax_url,type:"get",data:f.param(o),success:function(e){if(e.data.create_checkout_session_config){if(e.data.estimated_order_amount){var a=JSON.parse(e.data.estimated_order_amount);void 0!==a.amount&&void 0!==a.currencyCode&&c.updateButtonInfo(a)}c.initCheckout({createCheckoutSessionConfig:e.data.create_checkout_session_config})}},error:function(e,a,n){console.error(n)}}).always(function(){a&&p(a)})}})}function r(e,a){f(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),e.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+a+"</div>"),e.removeClass("processing").unblock()}function d(e,a,n){var o=i(e,a);null!==o&&o.initCheckout({createCheckoutSessionConfig:n})}function i(e,d){if(e=(e=e||m)instanceof f.Event?m:e,function(e){var a=f("cart"===e?"#wc-apa-update-vals-cart":"#wc-apa-update-vals");if(!a.length)return;var n=a.data("value");f.extend(amazon_payments_advanced,n),a.remove()}(d="string"!=typeof d?null:d),0!==f(e).length){s++;var i=null;return f(e).each(function(){var e=f(this),a=e.attr("id");if(m!=="#"+a||e.is(":visible")){void 0===a&&(a="pay_with_amazon_"+s,e.attr("id",a));var n=a;a="#"+a;var o=function(e){var a={merchantId:amazon_payments_advanced.merchant_id,ledgerCurrency:amazon_payments_advanced.ledger_currency,sandbox:"1"===amazon_payments_advanced.sandbox,placement:amazon_payments_advanced.placement,buttonColor:amazon_payments_advanced.button_color,checkoutLanguage:""!==amazon_payments_advanced.button_language?amazon_payments_advanced.button_language.replace("-","_"):void 0,productType:amazon_payments_advanced.action};"product"===e?a.productType=amazon_payments_advanced.product_action:"classic"===e&&null!==u?(a.productType=void 0!==u.payloadJSON.addressDetails?"PayAndShip":"PayOnly",u.payloadJSON=JSON.stringify(u.payloadJSON),null!==_&&void 0!==_.amount&&void 0!==_.currencyCode&&(a.estimatedOrderAmount=_)):(a.createCheckoutSessionConfig=amazon_payments_advanced.create_checkout_session_config,a.estimatedOrderAmount=amazon_payments_advanced.estimated_order_amount);return a}(d),t=amazon_payments_advanced.create_checkout_session_hash,c=e.data("amazonRenderedSettings");if(void 0!==c){if(c===t)return;var r=f("<"+e.get(0).tagName+"/>").attr("id",n);r.insertBefore(e),e.remove(),e=r}e.data("amazonRenderedSettings",t),i=amazon.Pay.renderButton(a,o),e.siblings(".wc-apa-button-separator").show()}}),i}}function a(e,a){var n=f(e);0!==n.length&&n.data("wc_apa_chage_bind")!==a&&(n.data("wc_apa_chage_bind",a),n.on("click",function(e){e.preventDefault()}),amazon.Pay.bindChangeAction(e,{amazonCheckoutSessionId:amazon_payments_advanced.checkout_session_id,changeAction:a}))}function n(e){0===f("."+e+"__field-wrapper").children().filter(function(){return f(this).is(":not(.hidden)")&&"none"!==f(this).css("display")}).length?f("."+e).addClass("hidden"):f("."+e).removeClass("hidden")}function l(e){!function(e){return e.is(".processing")||e.parents(".processing").length}(e)&&e.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}function p(e){e.removeClass("processing").unblock()}function h(e){var o=f(this);if(e.preventDefault(),!o.data("sending")){o.data("sending",!0);var t=o.parents(".create-account");l(t),f.ajax({type:"post",url:o.prop("href"),success:function(e){p(t),o.data("sending",!1)},error:function(e,a,n){p(t),o.data("sending",!1)}})}}function e(){if(0<f("#amazon-logout").length&&"amazon_payments_advanced"===f("input[name=payment_method]:checked").val()){if(n("woocommerce-billing-fields"),n("woocommerce-shipping-fields"),n("woocommerce-additional-fields"),a("#payment_method_widget_change","changePayment"),a("#shipping_address_widget_change","changeAddress"),0<f(".woocommerce-billing-fields .woocommerce-billing-fields__field-wrapper > *").length&&f(".woocommerce-billing-fields").insertBefore("#payment"),0<f(".woocommerce-account-fields").length&&f(".woocommerce-account-fields").insertBefore("#wc-apa-account-fields-anchor"),0<f(".woocommerce-shipping-fields .woocommerce-shipping-fields__field-wrapper > *").length){var e=f("#ship-to-different-address");e.find(":checkbox#ship-to-different-address-checkbox").hide(),e.find("span").text(amazon_payments_advanced.shipping_title),f(".woocommerce-shipping-fields").insertBefore("#payment")}f(".woocommerce-additional-fields").insertBefore("#payment"),f(".wc-apa-send-confirm-ownership-code").on("click",h)}}i(),f(document.body).on("updated_wc_div",i),f(document.body).on("updated_checkout",i),f(document.body).on("payment_method_selected",i),f(document.body).on("updated_shipping_method",i),e(),f("body").on("updated_checkout",e),f("body").on("payment_method_selected",e)})}(jQuery);
